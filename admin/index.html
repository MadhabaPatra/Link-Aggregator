<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	
	<title id="page-title">Admin</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  
            <div class="container text-center">
                <h2>Welcome <span id="admin_name"> </span>  </h2>
       <p><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" >Add New Link </button> &nbsp;&nbsp; &nbsp; <button type="button" class="btn btn-danger" id="btn_logout">Logout</button></p>            
               
		    
		    <table class="table table-striped guides">
                 <div class="alert alert-success">
       your site is published at <a id="user-link"></a>
                  </div>
                  <tbody>
                   
                   
                  </tbody>
                </table>
              </div>
	
	
	
          <!-- Model open after click add link -->     
         
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New Link/Button</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Title:</label>
            <input type="text" class="form-control" id="title">
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label">Your Link:</label>
            <input type="text" class="form-control" id="link" />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-success" id="btn_add">Save</button>
      </div>
    </div>
  </div>
</div>      
        

	
        <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.4.2/firebase-firestore.js"></script>
    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#config-web-app -->

    <script>  
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyBv6yIMLAPO2AsrQDSMCuNSzWQKeGgUq5A",
        authDomain: "test-18579.firebaseapp.com",
        databaseURL: "https://test-18579.firebaseio.com",
        projectId: "test-18579",
        storageBucket: "test-18579.appspot.com",
        messagingSenderId: "119631748247",
        appId: "1:119631748247:web:79ba28cac84bdc4a"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var auth=firebase.auth();
    const db=firebase.firestore();

    

    </script>



<script>  
	
firebase.auth().onAuthStateChanged(user=>{ 

  if(user){
   const user_mail= user.email;
	  //User Dyanamic Link
	  const cust_link="LinkC/"+user_mail;
	  document.getElementById('user-link').innerHTML=cust_link;
	 document.getElementById('user-link').href="http://localhost:9000/"+cust_link;
   console.log(user.email);
	  
	  // search for user
    var docRef = db.collection("users").doc(user_mail);

    docRef.get().then(function(doc) {
        if (doc.exists) {
           console.log(doc.data());
		document.getElementById('admin_name').innerHTML=doc.data().Username;
                  
		document.getElementById('page-title').innerHTML=doc.data().Username;
		// List of Buttons which is created bu user
		
		 db.collection('users').doc(user_mail).collection('user-button').get().then(snapshot => {
   
   setupGuides(snapshot.docs);
 }) ;
 
const guideList= document.querySelector('.guides');

 const setupGuides= (data) =>{
  let html='';
   const head=`
   <thead>
                    <tr>
                     
                      <th>Titles</th>
                      <th>Links</th>
                      <th>DELETE BUTTON</th>
                    </tr>
                  </thead>
   `;
   html+=head;
  data.forEach(docs=> {
    const users=docs.data();
    
    const li= `
    <tr>
    <td>   
     ${users.Title} 
     </td>
    
     <td>
     <a href=' ${users.Link}
     '> ${users.Link}</a>
     </td>
     <td>
        <button type="button" class="btn btn-danger delete-btn" >Delete</button>
     </td>
     </tr>
     
    `;
    
    html+=li
  });
  guideList.innerHTML=html;
  
 }
		
        } // if docs exist closed
	    else {
            // doc.data() will be undefined in this case
            console.log("No such document!");
        }
   	  
	 }) 
  }
  else {
   window.location='http://madhaba.me/Link-Aggregator/Login/index.html';
  }
});


     </script>
    

<script>  

document.getElementById("btn_logout").addEventListener('click', e=>{
  firebase.auth().signOut();
  
})
 </script>

<script>  
	
firebase.auth().onAuthStateChanged(user=>{ 

  if(user){
   const user_mail= user.email;
	// add new link to user button 
	 document.getElementById("btn_add").addEventListener('click', e=>{
	 const title=document.getElementById('title').value;
	 const link=document.getElementById('link').value;
      db.collection('users').doc(user_mail).collection('user-button').add({
          Title: title,
          Link: link
           })
        .then(function(docRef) {
        window.location='http://madhaba.me/Link-Aggregator/admin/index.html';
             }) 

	 
	 
	 }) // end of button event
  } //end of if 
});
	  
	</script>


</body>
</html>
